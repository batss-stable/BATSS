<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ANCOVA • BATSS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="ANCOVA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">BATSS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><h6 class="dropdown-header" data-toc-skip>Main topics</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/ingredients.html">BATSS Ingredients</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/priors.html">Prior distributions</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/parallelisation.html">Parallel and cluster computation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../../articles/web_only/ancova.html">ANCOVA</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/negbin.html">Negative binomial endpoint</a></li>
    <li><a class="dropdown-item" href="../../articles/web_only/binomial.html">Binomial endpoint</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>ANCOVA</h1>
            
      

      <div class="d-none name"><code>ancova.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<p>This example is motivated by the EMPACT trial - a phase IIb
randomised controlled clinical trial exploring the efficacy and safety
of psilocybin-assisted psychotherapy (PAP) in the treatment of people
diagnosed with treatment resistant major depressive disorder.</p>
<p>EMPACT is a Bayesian adaptive multi-arm multi-stage trial with
response-adaptive randomisation. It compares the average reversed
‘Hamilton Depression Rating Scale’ scores (R-HAM-D; where large R-HAM-D
correspond to better outcome) one month after the last PAP session for
patients allocated to an experimental group compared with the control
group. There are three experimental groups, each treated with different
Psilocybin doses; the control treatment consists of an active
comparator.</p>
<p>Here an ANCOVA model is considered to account for each patient’s
baseline R-HAM-D score, as this might lead to efficiency gains. Indeed,
the required sample size to detect any effect can be reduced by a factor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ρ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(1-\rho)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
is the correlation between the baseline R-HAM-D score and the R-HAM-D
score at one month. For more details on baseline covariate adjustment
methods in RCTs, check, for example, <span class="citation">Shiyuan
Zhang and Thabane (2014)</span>.</p>
</div>
<div class="section level2">
<h2 id="design">Design<a class="anchor" aria-label="anchor" href="#design"></a>
</h2>
<p>The chosen design has the following characteristics:</p>
<ul>
<li>
<strong>treatment arms</strong>: Our study has 4 arms: an active
control treatment (arm “Ctrl”) and 3 (experimental) groups treated with
different Psilocybin doses (referred to as arms “D1”, “D2” and
“D3”).</li>
<li>
<strong>additional predictor:</strong> to control for baseline
R-HAM-D scores (continuous predictor). R-HAM-D scores at baseline are
assumed to be associated with R-HAM-D score taken after one month, i.e.,
with the primary endpoint.</li>
<li>
<strong>alternative hypotheses</strong>: This is a superiority trial
where we are interested in demonstrating efficacy for an experimental
arm compared to the shared control group. Experimental arms will not be
compared to one another.</li>
<li>
<strong>interim analyses and maximum sample size</strong>: We will
begin the interim analyses at 50 participants completing follow-up, and
perform interim analyses every 20 participants completing follow-up
thereafter. Our maximum sample size is 130 participants with a total of
5 looks planned. We assume that recruitment is fairly slow in this
trial.</li>
<li>
<strong>endpoint conditional distribution</strong>: `R-HAM-D’ scores
at one month are assumed to follow a Gaussian distribution.</li>
<li>
<strong>group allocation</strong>: the trial will start with equal
randomisation (1:1:1:1) and RAR will be used from interim analysis 1
onwards. The randomisation probabilities are calculated using a
variation of <span class="citation">Trippa et al. (2012)</span> and
<span class="citation">Cellamare et al. (2017)</span> where the
allocation probabilities at look
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
are proportional to:
<ul>
<li>control arm:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mtext mathvariant="normal">exp</mtext><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">max</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>n</mi><mrow><mn>0</mn><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>ν</mi></msup></mrow><msub><mi>K</mi><mi>j</mi></msub></mfrac><annotation encoding="application/x-tex"> \frac{\text{exp}\left(\text{max}(n_{kj}) - n_{0j}\right)^{\nu}}{K_j}</annotation></semantics></math>
where
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">n_{kj}</annotation></semantics></math>
corresponds to the sample size of arm
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k=0</annotation></semantics></math>
denotes the control arm) at stage
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">max</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{max}(n_{kj})</annotation></semantics></math>
is evaluated across intervention arms only (i.e. for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k&gt;0</annotation></semantics></math>),</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>K</mi><mi>j</mi></msub><annotation encoding="application/x-tex">K_j</annotation></semantics></math>
is the number of active arms (excluding control) at look
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ν</mi><mo>=</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">\nu=0.1</annotation></semantics></math>
is a tuning parameter.</li>
</ul>
</li>
<li>intervention arms:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mtext mathvariant="normal">Prob</mtext><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>k</mi></msub><mo>&gt;</mo><msub><mi>δ</mi><mi>r</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>h</mi></msup></mrow><mrow><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><mtext mathvariant="normal">Prob</mtext><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>k</mi></msub><mo>&gt;</mo><msub><mi>δ</mi><mi>r</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>h</mi></msup></mrow></mfrac><annotation encoding="application/x-tex">\frac{\text{Prob}(\beta_k&gt;\delta_{r}|y,X)^h}{\sum_{k=1}^K \text{Prob}(\beta_k&gt;\delta_{r}|y,X)^h}</annotation></semantics></math>
where
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\beta_k</annotation></semantics></math>
denotes the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>th
target parameter,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>r</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\delta_{r} = 0</annotation></semantics></math>
denotes the (RAR-related) clinically meaningful treatment effect
value,</li>
<li>and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>=</mo><mi>γ</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></msubsup><msub><mi>n</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mi>/</mi><mi>N</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>η</mi></msup></mrow><annotation encoding="application/x-tex">h = \gamma(\sum_{k=0}^{K} n_{kj} / N)^{\eta}</annotation></semantics></math>
with
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">n_{kj}</annotation></semantics></math>,
the sample size of arm
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
at stage
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
the maximum sample size,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\gamma=3</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mo>=</mo><mn>1.4</mn></mrow><annotation encoding="application/x-tex">\eta=1.4</annotation></semantics></math>,
two tuning parameters. Refer to <span class="citation">Gotmaker et al.
(2019)</span> for details</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>arm efficacy stopping rule</strong>: Early stopping of
intervention arms for efficacy may occur if there is a high posterior
probability of (any) benefit at look
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
i.e., when
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Prob</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>k</mi></msub><mo>&gt;</mo><msub><mi>δ</mi><mi>ϵ</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mn>1</mn><mo>−</mo><msub><mi>b</mi><mi>ϵ</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>∑</mo><mrow><mi>g</mi><mo>=</mo><mn>0</mn></mrow><mi>G</mi></munderover><msub><mi>n</mi><mi>g</mi></msub><mi>/</mi><mi>N</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>p</mi><mi>ϵ</mi></msub></msup></mrow><annotation encoding="application/x-tex">\text{Prob}(\beta_k &gt; \delta_{\epsilon}|y, X) &gt; 1-b_{\epsilon}\left(\sum_{g=0}^{G}n_{g}/N\right)^{p_{\epsilon}}</annotation></semantics></math>
where
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>ϵ</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\delta_{\epsilon} = 0</annotation></semantics></math>
denotes the (efficacy-related) clinically meaningful treatment effect
value,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>ϵ</mi></msub><mo>=</mo><mn>0.0115</mn></mrow><annotation encoding="application/x-tex">b_{\epsilon}=0.0115</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>ϵ</mi></msub><mo>=</mo><mn>1.575</mn></mrow><annotation encoding="application/x-tex">p_{\epsilon}=1.575</annotation></semantics></math>
are tuning parameters.</li>
</ul>
</li>
<li>
<strong>arm futility stopping rule</strong>: Early stopping of
intervention arms for futility may occur if there is a low posterior
probability of observing a reduction of at least 3 in the mean R-HAM-D
score (from baseline to 1 month), i.e., when
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Prob</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>β</mi><mi>k</mi></msub><mo>&gt;</mo><msub><mi>δ</mi><mi>f</mi></msub><mo stretchy="false" form="prefix">|</mo><mi>y</mi><mo>,</mo><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><msub><mi>b</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex"> \text{Prob}(\beta_k &gt; \delta_{f}|y, X) &lt; b_f</annotation></semantics></math>
where
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>δ</mi><mi>f</mi></msub><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">\delta_{f} = 3</annotation></semantics></math>
denotes the (futility-related) clinically meaningful treatment effect
values,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>f</mi></msub><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">b_{f} = 0.05</annotation></semantics></math>
is the cut-off value used to declare futility.</li>
</ul>
</li>
<li>
<strong>trial stopping rule:</strong> The trial will run until an
efficacy or futility decision has been reached for each intervention
arm, or once the maximum sample size has been reached (separate stopping
rules for each arm).</li>
</ul>
<p>Note that, in the above, the tuning parameter values have been
optimised to lead to suitable operating characteristics, namely,</p>
<ul>
<li>a familywise error rate (FWER) of 0.05 under the global null
hypothesis,</li>
<li>a probability of efficacy per arm of 0.8 or higher when assuming a
difference in mean of 5 compared to the control group,</li>
<li>a probability of early futility stopping per arm of 0.7 under
H0.</li>
</ul>
<p>In the following, we define the group allocation, RAR, futility and
efficacy functions corresponding to the design described above.</p>
<div class="section level4">
<h4 id="rar">RAR<a class="anchor" aria-label="anchor" href="#rar"></a>
</h4>
<p>We need to generate a function that defines the allocation
probabilities of patients to the different active arms as a function
of</p>
<ul>
<li>relevant <em>ingredients</em>, i.e.,
<ul>
<li>
<code>posterior</code>, for the posterior probabilities of the
target parameter being greater than <code>delta.RAR = 0</code>,</li>
<li>
<code>n</code> and <code>N</code>, respectively the sample size per
arm at the look of interest and the max sample size to define the
information fraction,</li>
<li>
<code>ref</code>, for a vector of logicals indicating which group is
the reference one,</li>
<li>
<code>active</code>, for a vector of logicals indicating which
groups are active at the look of interest,</li>
</ul>
</li>
<li>relevant tuning parameters (to be added to <code>RAR.control</code>
in <code>batss.glm</code>), namely
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>η</mi><annotation encoding="application/x-tex">\eta</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ν</mi><annotation encoding="application/x-tex">\nu</annotation></semantics></math>,
that we will respectively call <code>gamma</code>, <code>eta</code> and
<code>nu</code>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">trippa.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">posterior</span>,<span class="va">n</span>,<span class="va">N</span>,<span class="va">ref</span>,<span class="va">active</span>,<span class="va">gamma</span>,<span class="va">eta</span>,<span class="va">nu</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">g</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">active</span><span class="op">)</span></span>
<span>  <span class="va">h</span> <span class="op">=</span> <span class="va">gamma</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="va">N</span><span class="op">)</span><span class="op">^</span><span class="va">eta</span></span>
<span>  <span class="va">prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">g</span><span class="op">)</span></span>
<span>  <span class="co"># reference/control arm allocation</span></span>
<span>  <span class="va">prob</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n</span><span class="op">[</span><span class="op">!</span><span class="va">ref</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="va">n</span><span class="op">[</span><span class="va">ref</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="va">nu</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">g</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># targets/interventions (that haven't been dropped)</span></span>
<span>  <span class="va">prob</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="va">g</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="va">posterior</span><span class="op">^</span><span class="va">h</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">^</span><span class="va">h</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span>   </span>
<span><span class="op">}</span></span>
<span><span class="co"># test after at the first look with two set of posterior probabilities</span></span>
<span><span class="co"># 1/ c(.5,.5,.5,.5,.5)</span></span>
<span><span class="co"># 2/ c(.5,.5,.5,.5,.6)</span></span>
<span><span class="fu">trippa.fun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">.5</span>,<span class="fl">.5</span>,<span class="fl">.5</span>,<span class="fl">.5</span><span class="op">)</span>,n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>A<span class="op">=</span><span class="fl">10</span>,B<span class="op">=</span><span class="fl">10</span>,C<span class="op">=</span><span class="fl">10</span>,D<span class="op">=</span><span class="fl">10</span>,E<span class="op">=</span><span class="fl">10</span>,F<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,N<span class="op">=</span><span class="fl">16</span>,</span>
<span>            ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>, active <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="fl">6</span><span class="op">)</span>,</span>
<span>            gamma<span class="op">=</span><span class="fl">3</span>, eta<span class="op">=</span><span class="fl">1.4</span>, nu<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>Note that this corresponds to the function <code>RAR.trippa</code>
available in the <strong>BATSS</strong> package.</p>
</div>
<div class="section level4">
<h4 id="group-allocation">Group allocation<a class="anchor" aria-label="anchor" href="#group-allocation"></a>
</h4>
<p>We need to generate a function that randomises the <code>m</code>
participants of the next look according to the allocation ratios
<code>prob</code>, where <code>m</code> and <code>prob</code> are
ingredients described in the <a href="Ingredients.html">Ingredients
section</a> and where <code>prob</code> is the output of the
user-defined RAR function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">treatalloc.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">m</span>,<span class="va">prob</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">prob</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">m0.g</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">prob</span><span class="op">*</span><span class="va">m</span><span class="op">)</span></span>
<span>  <span class="va">m0</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m0.g</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span>,<span class="va">m0.g</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">m</span><span class="op">-</span><span class="va">m0</span>,<span class="va">prob</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># test on m = 50 patients and equal allocation per group </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">treatalloc.fun</span><span class="op">(</span>m<span class="op">=</span><span class="fl">50</span>,prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Ctrl<span class="op">=</span><span class="fl">1</span>, D1<span class="op">=</span><span class="fl">1</span>, D2<span class="op">=</span><span class="fl">1</span>, D3<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>treatalloc.fun</code> first allocates the largest possible
number of units to the different groups given their exact target
probabilities and then assigns randomly the remaining units to the
different groups according to multinomial draws.</p>
<p>Note that this corresponds to the function
<code>alloc.balanced</code> available in the <strong>BATSS</strong>
package.</p>
</div>
<div class="section level4">
<h4 id="arm-efficacy-stopping-rule">Arm efficacy stopping rule<a class="anchor" aria-label="anchor" href="#arm-efficacy-stopping-rule"></a>
</h4>
<p>We need to generate a function that leads to a logical output
(<code>TRUE</code> if the arm needs to be stopped for efficacy and
<code>FALSE</code> otherwise) and takes as input</p>
<ul>
<li>the ingredient <code>posterior</code> for the posterior probability
of the target parameter being greater than
<code>delta.eff = 0</code>,</li>
<li>
<code>n</code> and <code>N</code>, respectively the sample size per
arm at the look of interest and the max sample size to define the
information fraction,</li>
<li>the additional parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>ϵ</mi></msub><annotation encoding="application/x-tex">b_{\epsilon}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>ϵ</mi></msub><annotation encoding="application/x-tex">p_{\epsilon}</annotation></semantics></math>
that we will respectively name <code>b.eff</code> and <code>p.eff</code>
(and that needs to be added to <code>eff.arm.control</code> in
<code>batss.glm</code>).</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">efficacy.arm.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">posterior</span>,<span class="va">n</span>,<span class="va">N</span>,<span class="va">b.eff</span>,<span class="va">p.eff</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">posterior</span> <span class="op">&gt;</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">b.eff</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="va">N</span><span class="op">)</span><span class="op">^</span><span class="va">p.eff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># test for a parameter with a posterior = 0.999</span></span>
<span><span class="fu">efficacy.arm.fun</span><span class="op">(</span><span class="fl">0.999</span>, n<span class="op">=</span><span class="fl">100</span>, N<span class="op">=</span><span class="fl">1000</span>, b.eff <span class="op">=</span> <span class="fl">0.045</span>, p.eff<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span>
<span><span class="co"># test for a parameter with a posterior = 0.95</span></span>
<span><span class="fu">efficacy.arm.fun</span><span class="op">(</span><span class="fl">0.95</span>, n<span class="op">=</span><span class="fl">100</span>, N<span class="op">=</span><span class="fl">1000</span>, b.eff <span class="op">=</span> <span class="fl">0.045</span>, p.eff<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<p>Note that this corresponds to the function
<code>eff.arm.infofract</code> available in the <strong>BATSS</strong>
package.</p>
</div>
<div class="section level4">
<h4 id="arm-futility-stopping-rule">Arm futility stopping rule<a class="anchor" aria-label="anchor" href="#arm-futility-stopping-rule"></a>
</h4>
<p>We need to generate a function that leads to a logical output
(<code>TRUE</code> if the arm needs to be stopped for futility and
<code>FALSE</code> otherwise) and takes as input</p>
<ul>
<li>the ingredient <code>posterior</code> for the posterior probability
of the target parameter being greater than
<code>delta.fut = log(1.5)</code>,</li>
<li>the additional parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>f</mi></msub><annotation encoding="application/x-tex">b_{f}</annotation></semantics></math>
that we will name <code>b.fut</code> (and that needs to be added to
<code>fut.arm.control</code> in <code>batss.glm</code>)</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">futility.arm.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">posterior</span>,<span class="va">b.fut</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">posterior</span> <span class="op">&lt;</span> <span class="va">b.fut</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># test </span></span>
<span><span class="fu">futility.arm.fun</span><span class="op">(</span><span class="fl">0.9</span>, b.fut<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu">futility.arm.fun</span><span class="op">(</span><span class="fl">0.075</span>, b.fut<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>Note that this corresponds to the function
<code>fut.arm.simple</code> available in the <strong>BATSS</strong>
package.</p>
</div>
<div class="section level4">
<h4 id="trial-efficacy-and-futility-stopping-rule">Trial efficacy and futility stopping rule<a class="anchor" aria-label="anchor" href="#trial-efficacy-and-futility-stopping-rule"></a>
</h4>
<p>We need to generate functions that, based on the ingredients
<code>eff.target</code> and <code>fut.target</code> (respectively
indicating if efficacy and futility were declared for each target
parameter at the stage of interest or before) leads to a logical output
equal to <code>TRUE</code> if all target parameters were respectively
declared efficacious or futile, and <code>FALSE</code> otherwise.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function</span></span>
<span><span class="va">efficacy.trial.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">eff.target</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">eff.target</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># function</span></span>
<span><span class="va">futility.trial.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">fut.target</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">fut.target</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># test </span></span>
<span><span class="fu">futility.trial.fun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>D1<span class="op">=</span><span class="cn">TRUE</span>,D2<span class="op">=</span><span class="cn">TRUE</span>,D3<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">efficacy.trial.fun</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>D1<span class="op">=</span><span class="cn">TRUE</span>,D2<span class="op">=</span><span class="cn">TRUE</span>,D3<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that these correspond to the functions
<code>eff.trial.all</code> and <code>fut.trial.all</code> available in
the <strong>BATSS</strong> package which are used by default and that
this behaviour is the default one of the function <code>batss.glm</code>
when <code>fut.trial = NULL</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="monte-carlo-simulations">Monte Carlo Simulations<a class="anchor" aria-label="anchor" href="#monte-carlo-simulations"></a>
</h2>
<p>We consider three scenarios: a first one that does not control for
‘baseline R-HAM-D scores’ and two that do and assume different
correlation levels between R-HAM-D scores at baseline (predictor 4) and
after one month (primary endpoint). Thus,</p>
<ul>
<li>the primary predictor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>1</mn></msub><annotation encoding="application/x-tex">x_1</annotation></semantics></math>,
is the 4-level treatment group factor with the control group as
reference group,</li>
<li>the secondary predictor,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mn>2</mn></msub><annotation encoding="application/x-tex">x_2</annotation></semantics></math>,
is the centered ‘R-HAM-D scores’ at baseline.</li>
</ul>
<p>For the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
participant, our assumed model is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><mi>ι</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>′</mi><mi>D</mi><mn>1</mn><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><mi>ι</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>′</mi><mi>D</mi><mn>2</mn><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>3</mn></msub><mi>ι</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>′</mi><mi>D</mi><mn>3</mn><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>β</mi><mn>4</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>x</mi><mrow><mi>i</mi><mn>2</mn></mrow></msub><mo>−</mo><mover><mi>_</mi><mo accent="true">‾</mo></mover><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><msub><mi>ϵ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i = \beta_0 + \beta_1 \iota(x_{i1}='D1') + \beta_2 \iota(x_{i1}='D2') + \beta_3 \iota(x_{i1}='D3') + \beta_4 [x_{i2} - \bar_{x_{2}}] + \epsilon_i</annotation></semantics></math>,</p>
<p>where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mrow><mi>i</mi><mi>p</mi></mrow></msub><annotation encoding="application/x-tex">x_{ip}</annotation></semantics></math>
denotes the value of the predictor
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
for participant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ι</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\iota(.)</annotation></semantics></math>
denotes the indicator function that equals to 1 if the condition is
satisfied and 0 otherwise,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>_</mi><mo accent="true">‾</mo></mover><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\bar_{x_{2}}</annotation></semantics></math>
denotes the average ‘R-HAM-D scores’ at baseline.</li>
</ul>
<p>This parameterisation leads to the following parameter
interpretation:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>
corresponds to the average ‘R-HAM-D scores’ of patients at baseline, as
well as after one month of treatment for patients of the “Ctrl”
arm,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\beta_1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\beta_2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>3</mn></msub><annotation encoding="application/x-tex">\beta_3</annotation></semantics></math>
respectively correspond to the average shift in mean between the R-HAM-D
scores at one month for each treatment arm (“D1”, “D2” and “D3”)
compared to the control one (“Ctrl”),</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>4</mn></msub><annotation encoding="application/x-tex">\beta_4</annotation></semantics></math>
is the regression parameter related to participant ‘R-HAM-D’ scores at
baseline.</li>
</ul>
<p>We assume</p>
<ul>
<li>a mean of 5 in the control arm and then a mean change from control
of 5 in each intervention so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>β</mi><mn>0</mn></msub><mo>,</mo><msub><mi>β</mi><mn>1</mn></msub><mo>,</mo><msub><mi>β</mi><mn>2</mn></msub><mo>,</mo><msub><mi>β</mi><mn>3</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><mi>T</mi></msup><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo stretchy="true" form="postfix">]</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">[\beta_0, \beta_1, \beta_2, \beta_3]^T = [5,5,5,5]^T</annotation></semantics></math><br>
</li>
<li>a standard deviation of the response <em>given</em> the 4-level
‘treatment’ predictor, equal to 7, i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>y</mi></msub><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\sigma_y=7</annotation></semantics></math>.</li>
</ul>
<p>When controlling for the (centered) ‘R-HAM-D scores’ at baseline, we
further need to define * the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>4</mn></msub><annotation encoding="application/x-tex">\beta_4</annotation></semantics></math>,
* the values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub></msub><annotation encoding="application/x-tex">\sigma_{x_4}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>ϵ</mi></msub><annotation encoding="application/x-tex">\sigma_{\epsilon}</annotation></semantics></math>,
the standard deviations of ‘baseline R-HAM-D scores’ and of the error
term, so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>,
the Pearson’s correlation level between the centered ‘baseline R-HAM-D
scores’ and ‘R-HAM-D scores at one month’ <em>given</em> the 4-level
‘treatment’ predictor, equals the target correlation level. This is
achieved, in the ANCOVA setting, by choosing values respecting the
following equalities: *
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><msub><mi>β</mi><mn>4</mn></msub><mfrac><msub><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub></msub><msub><mi>σ</mi><mi>y</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\rho = \beta_4 \frac{\sigma_{x_{4}}}{\sigma_y}</annotation></semantics></math>,
*
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>=</mo><msubsup><mi>β</mi><mn>4</mn><mn>2</mn></msubsup><msubsup><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>σ</mi><mi>ϵ</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\sigma_y^2 = \beta_4^2\sigma_{x_{4}}^2+\sigma_{\epsilon}^2</annotation></semantics></math>,
where the former comes from the relationship between (simple) linear
regression and Pearson’s correlation coefficient and the later comes
from the law of total variance.</p>
<div class="section level4">
<h4 id="scenario-0">Scenario 0<a class="anchor" aria-label="anchor" href="#scenario-0"></a>
</h4>
<p>In Scenario 0, we don’t correct for baseline R-HAM-D scores.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://batss-stable.github.io/BATSS/" class="external-link">BATSS</a></span><span class="op">)</span></span>
<span><span class="co"># number of trials</span></span>
<span><span class="va">R</span> <span class="op">=</span> <span class="fl">100</span></span>
<span></span>
<span></span>
<span><span class="co"># simulation</span></span>
<span><span class="va">scenario0</span> <span class="op">=</span> <span class="fu"><a href="../../reference/batss.glm.html">batss.glm</a></span><span class="op">(</span>   </span>
<span>  model           <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">group</span>,</span>
<span>  var             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rnorm</span>,</span>
<span>                         group <span class="op">=</span> <span class="va">treatalloc.fun</span><span class="op">)</span>,</span>
<span>  var.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  family          <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  link            <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  beta            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  which           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  R               <span class="op">=</span> <span class="va">R</span>,</span>
<span>  alternative     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"greater"</span><span class="op">)</span>,</span>
<span>  RAR             <span class="op">=</span> <span class="va">trippa.fun</span>,</span>
<span>  RAR.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gamma<span class="op">=</span><span class="fl">3</span>,eta<span class="op">=</span><span class="fl">1.4</span>,nu<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  delta.RAR       <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prob0           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Ctrl<span class="op">=</span><span class="fl">1</span>,D1<span class="op">=</span><span class="fl">1</span>,D2<span class="op">=</span><span class="fl">1</span>,D3<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  N               <span class="op">=</span> <span class="fl">130</span>, </span>
<span>  interim         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>recruited<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m0<span class="op">=</span><span class="fl">50</span>, m<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  eff.arm         <span class="op">=</span> <span class="va">efficacy.arm.fun</span>,</span>
<span>  delta.eff       <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  eff.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.eff <span class="op">=</span> <span class="fl">0.0115</span>, p.eff<span class="op">=</span><span class="fl">1.575</span><span class="op">)</span>,</span>
<span>  delta.fut       <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  fut.arm         <span class="op">=</span> <span class="va">futility.arm.fun</span>,</span>
<span>  fut.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.fut <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  computation     <span class="op">=</span> <span class="st">"parallel"</span>,</span>
<span>  mc.cores        <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  H0              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extended        <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>   </span></code></pre></div>
<p>You can note that</p>
<ul>
<li><p><code>beta</code>, the regression parameter vector equals
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo stretchy="true" form="postfix">]</mo></mrow><mi>T</mi></msup><annotation encoding="application/x-tex">[5,5,5,5]^T</annotation></semantics></math>,</p></li>
<li>
<p><code>y</code> is generated via the function <code>rnorm</code>
as well and has an average of respectively</p>
<ul>
<li>
<code>5</code> for the reference group,</li>
<li>
<code>5+5 = 10</code> for all other groups (as contrasts of type
treatment are used for the factor <code>treatment</code> in the
self-defined function <code>treatalloc.fun</code>),</li>
</ul>
</li>
<li><p>the target parameters (average shift in mean between the R-HAM-D
scores at one month for each treatment arm (“D1”, “D2” and “D3”)
compared to the control arm) are in position 2 to 4 of the fitted
coefficients obtained when using the formula
<code>y~group</code>,</p></li>
<li>
<p><code>prob0</code> provides</p>
<ul>
<li>the (equal) allocation probabilities at the start of the trial,</li>
<li>the names of the groups,</li>
</ul>
</li>
<li><p><code>eff.arm</code> and <code>fut.arm</code> are set to the
functions defined above (i.e., <code>efficacy.arm.fun</code> and
<code>futility.arm.fun</code>),</p></li>
<li><p><code>fut.trial</code> is not specified and therefore equal to
<code>NULL</code> (default) which leads to the behaviour wished in this
case,</p></li>
<li><p>the values of the additional parameters of
<code>efficacy.arm.fun</code> and <code>futility.arm.fun</code> (i.e.,
<code>b.eff</code> and <code>b.fut</code>) are specified under
<code>eff.arm.control</code> and <code>fut.arm.control</code>,</p></li>
<li><p><code>delta.eff</code> and <code>delta.fut</code> are
respectively set to <code>0</code> and <code>3</code>.</p></li>
</ul>
<p>We chose here a low number of seeds/trials (<code>R=100</code>) to
save time. Note that, as <code>H0=TRUE</code>, the results under the
global null are also defined.</p>
</div>
<div class="section level4">
<h4 id="scenario-1">Scenario 1<a class="anchor" aria-label="anchor" href="#scenario-1"></a>
</h4>
<p>In Scenario 1, we assume a correlation of 0 between R-HAM-D scores at
baseline and after one month so that</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>4</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\beta_4 = 0</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>ϵ</mi></msub><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\sigma_{\epsilon} = 7</annotation></semantics></math>.
This corresponds to a very unlikely scenario allowing us to see the drop
in power induced by adding to the model a predictor unrelated to the
response</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://batss-stable.github.io/BATSS/" class="external-link">BATSS</a></span><span class="op">)</span></span>
<span><span class="co"># number of trials</span></span>
<span><span class="va">R</span> <span class="op">=</span> <span class="fl">100</span></span>
<span></span>
<span></span>
<span><span class="co"># simulation</span></span>
<span><span class="va">scenario1</span> <span class="op">=</span> <span class="fu"><a href="../../reference/batss.glm.html">batss.glm</a></span><span class="op">(</span>   </span>
<span>  model           <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">group</span><span class="op">+</span><span class="va">baseline</span>,</span>
<span>  var             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rnorm</span>,</span>
<span>                         group <span class="op">=</span> <span class="va">treatalloc.fun</span>,</span>
<span>                         baseline <span class="op">=</span> <span class="va">rnorm</span><span class="op">)</span>,</span>
<span>  var.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  family          <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  link            <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  beta            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>  which           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  R               <span class="op">=</span> <span class="va">R</span>,</span>
<span>  alternative     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"greater"</span><span class="op">)</span>,</span>
<span>  RAR             <span class="op">=</span> <span class="va">trippa.fun</span>,</span>
<span>  RAR.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gamma<span class="op">=</span><span class="fl">3</span>,eta<span class="op">=</span><span class="fl">1.4</span>,nu<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  delta.RAR       <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prob0           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Ctrl<span class="op">=</span><span class="fl">1</span>,D1<span class="op">=</span><span class="fl">1</span>,D2<span class="op">=</span><span class="fl">1</span>,D3<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  N               <span class="op">=</span> <span class="fl">130</span>, </span>
<span>  interim         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>recruited<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m0<span class="op">=</span><span class="fl">50</span>, m<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  eff.arm         <span class="op">=</span> <span class="va">efficacy.arm.fun</span>,</span>
<span>  delta.eff       <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  eff.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.eff <span class="op">=</span> <span class="fl">0.0115</span>, p.eff<span class="op">=</span><span class="fl">1.575</span><span class="op">)</span>,</span>
<span>  delta.fut       <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  fut.arm         <span class="op">=</span> <span class="va">futility.arm.fun</span>,</span>
<span>  fut.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.fut <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  computation     <span class="op">=</span> <span class="st">"parallel"</span>,</span>
<span>  mc.cores        <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  H0              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extended        <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>   </span></code></pre></div>
<p>Compared to scenario 0, you can note that</p>
<ul>
<li>
<code>y</code>, the outcome vector, now depends on the R-HAM-D
scores at baseline,</li>
<li>
<code>beta</code>, the regression parameter vector equals
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">[</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>5</mn><mo>,</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mi>T</mi></msup><annotation encoding="application/x-tex">[5,5,5,5,0]^T</annotation></semantics></math>,</li>
<li>
<code>baseline</code> is generated with the function
<code>rnorm</code> (without further arguments in
<code>var.control</code> so that a standard normal distribution is
assumed, which is irrelevant as the corresponding beta coefficient is
equal to 0).</li>
</ul>
</div>
<div class="section level4">
<h4 id="scenario-2">Scenario 2<a class="anchor" aria-label="anchor" href="#scenario-2"></a>
</h4>
<p>In Scenario 2, we assume that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\rho = 0.6</annotation></semantics></math>
(a value mentioned in the EMPACT protocol),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub></msub><mo>=</mo><mn>3.5</mn></mrow><annotation encoding="application/x-tex">\sigma_{x_{4}} = 3.5</annotation></semantics></math>
while still requiring that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>ϵ</mi></msub><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">\sigma_{\epsilon} = 7</annotation></semantics></math>,
so that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mn>4</mn></msub><mo>=</mo><mi>ρ</mi><mfrac><msub><mi>σ</mi><mi>y</mi></msub><msub><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub></msub></mfrac><mo>=</mo><mn>0.6</mn><mo>×</mo><mfrac><mn>7</mn><mn>3.5</mn></mfrac><mo>=</mo><mn>1.2</mn><mo>,</mo></mrow><annotation encoding="application/x-tex">\beta_4 = \rho \frac{\sigma_y}{\sigma_{x_{4}}} = 0.6 \times \frac{7}{3.5} = 1.2,</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>ϵ</mi><mn>2</mn></msubsup><mo>=</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>−</mo><msubsup><mi>β</mi><mn>4</mn><mn>2</mn></msubsup><msubsup><mi>σ</mi><msub><mi>x</mi><mn>4</mn></msub><mn>2</mn></msubsup><mo>=</mo><msup><mn>7</mn><mn>2</mn></msup><mo>−</mo><msup><mn>1.2</mn><mn>2</mn></msup><mo>×</mo><msup><mn>3.5</mn><mn>2</mn></msup><mo>=</mo><mn>5.6</mn><mi>.</mi></mrow><annotation encoding="application/x-tex">\sigma_{\epsilon}^2 = \sigma_y^2 - \beta_4^2\sigma_{x_{4}}^2 = 7^2 - 1.2^2 \times 3.5^2 = 5.6.</annotation></semantics></math></p>
<p>The following code first defines the values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>4</mn></msub><annotation encoding="application/x-tex">\beta_4</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>ϵ</mi></msub><annotation encoding="application/x-tex">\sigma_{\epsilon}</annotation></semantics></math>,
the checks this values by simulation and finally defines the operating
characteristics of the design.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##</span></span>
<span><span class="co">## calculate the SIGMA.e and BETA values outside of the batss.glm function</span></span>
<span><span class="co">## </span></span>
<span></span>
<span><span class="va">SIGMA.x</span> <span class="op">=</span> <span class="fl">3.5</span></span>
<span><span class="va">SIGMA.y</span> <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="va">RHO</span>     <span class="op">=</span> <span class="fl">0.6</span></span>
<span><span class="va">BETA</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="va">RHO</span><span class="op">*</span><span class="va">SIGMA.y</span><span class="op">/</span><span class="va">SIGMA.x</span><span class="op">)</span></span>
<span><span class="va">SIGMA.e</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">SIGMA.y</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">BETA</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="va">SIGMA.x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">n</span>       <span class="op">=</span> <span class="fl">1e+5</span></span>
<span><span class="va">X</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/kronecker.html" class="external-link">kronecker</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,nrow<span class="op">=</span><span class="va">n</span><span class="op">/</span><span class="fl">4</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##</span></span>
<span><span class="co">## check values by simulation</span></span>
<span><span class="co">##</span></span>
<span></span>
<span><span class="va">sim.fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">seed</span>, <span class="va">Xmat</span>, <span class="va">BETA</span>, <span class="va">SIGMA.x</span>,<span class="va">SIGMA.e</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># seed=2</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>    <span class="va">Xmat</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Xmat</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">SIGMA.x</span><span class="op">)</span></span>
<span>    <span class="va">e</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Xmat</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">SIGMA.e</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">=</span> <span class="va">Xmat</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">BETA</span><span class="op">+</span><span class="va">e</span></span>
<span>    <span class="co">#</span></span>
<span>    <span class="va">fitw0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lmfit.html" class="external-link">lm.fit</a></span><span class="op">(</span><span class="va">Xmat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>,<span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">fitw1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lmfit.html" class="external-link">lm.fit</a></span><span class="op">(</span><span class="va">Xmat</span>,<span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitw1</span><span class="op">)</span>,rho<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fitw0</span><span class="op">)</span>,<span class="va">Xmat</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span><span class="op">)</span>,sigma_ytot<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      sigma_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">y</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Xmat</span><span class="op">)</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span>,<span class="va">var</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      sigma_e <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fitw1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span><span class="fu">.idf</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>,<span class="st">"seed"</span><span class="op">)</span></span>
<span><span class="va">toto</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">sim.fun</span>, Xmat<span class="op">=</span><span class="va">X</span>, BETA<span class="op">=</span><span class="va">BETA</span>, </span>
<span>         SIGMA.x<span class="op">=</span><span class="va">SIGMA.x</span>,SIGMA.e<span class="op">=</span><span class="va">SIGMA.e</span>, future.seed<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">toto</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">BETA</span>,<span class="va">RHO</span>,<span class="cn">NA</span>,<span class="va">SIGMA.y</span>,<span class="va">SIGMA.e</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toto</span><span class="op">)</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">toto</span><span class="op">)</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##</span></span>
<span><span class="co">## define operating characteristics </span></span>
<span><span class="co">##</span></span>
<span></span>
<span><span class="co"># number of trials</span></span>
<span><span class="va">R</span> <span class="op">=</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># simulation</span></span>
<span><span class="va">scenario2</span> <span class="op">=</span> <span class="fu"><a href="../../reference/batss.glm.html">batss.glm</a></span><span class="op">(</span>   </span>
<span>  model           <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">group</span><span class="op">+</span><span class="va">baseline</span>,</span>
<span>  var             <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rnorm</span>,</span>
<span>                         group <span class="op">=</span> <span class="va">treatalloc.fun</span>,</span>
<span>                         baseline <span class="op">=</span> <span class="va">rnorm</span><span class="op">)</span>,</span>
<span>  var.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="va">SIGMA.e</span><span class="op">)</span>, baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="va">SIGMA.x</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  family          <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  link            <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  beta            <span class="op">=</span> <span class="va">BETA</span>,</span>
<span>  which           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>  R               <span class="op">=</span> <span class="va">R</span>,</span>
<span>  alternative     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"greater"</span><span class="op">)</span>,</span>
<span>  RAR             <span class="op">=</span> <span class="va">trippa.fun</span>,</span>
<span>  RAR.control     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gamma<span class="op">=</span><span class="fl">3</span>,eta<span class="op">=</span><span class="fl">1.4</span>,nu<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  delta.RAR       <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  prob0           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Ctrl<span class="op">=</span><span class="fl">1</span>,D1<span class="op">=</span><span class="fl">1</span>,D2<span class="op">=</span><span class="fl">1</span>,D3<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>  N               <span class="op">=</span> <span class="fl">130</span>, </span>
<span>  interim         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>recruited<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m0<span class="op">=</span><span class="fl">50</span>, m<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  eff.arm         <span class="op">=</span> <span class="va">efficacy.arm.fun</span>,</span>
<span>  delta.eff       <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  eff.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.eff <span class="op">=</span> <span class="fl">0.0115</span>, p.eff<span class="op">=</span><span class="fl">1.575</span><span class="op">)</span>,</span>
<span>  delta.fut       <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  fut.arm         <span class="op">=</span> <span class="va">futility.arm.fun</span>,</span>
<span>  fut.arm.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b.fut <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  computation     <span class="op">=</span> <span class="st">"parallel"</span>,</span>
<span>  mc.cores        <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  H0              <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  extended        <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="co"># 2  </span></span></code></pre></div>
<p>Compared to ‘Scenario 1’, we can note the following differences:</p>
<ul>
<li>
<code>beta</code>, now a taking <code>1.2</code> as last value
instead of <code>0</code>,</li>
<li>
<code>var.control</code>, now indicating
<ul>
<li>an amended value for the standard deviation of the error term,</li>
<li>the standard deviation of the variable <code>baseline</code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="scenario-comparison">Scenario comparison<a class="anchor" aria-label="anchor" href="#scenario-comparison"></a>
</h4>
<p>Based on a simulation considering 10,000 Monte Carlo trials,</p>
<ul>
<li>For <em>Scenario 0</em>, the (estimated) FWER under the global null
hypothesis and power per arm under the alternative hypothesis
respectively equal 0.0498 and 0.8011,</li>
<li>For <em>Scenario 1</em>, now controlling for a further predictor not
associated with the primary endpoint, the FWER slightly increases to
0.0527 and the power per arm marginally decreases (0.7975),</li>
<li>For <em>Scenario 2</em>, now controlling for a further predictor
strongly associated with the primary endpoint, the FWER slightly
increases to 0.0550 and the power per arm jumps to 0.9424.</li>
</ul>
<p>This suggests that adding a predictor has little downside as:<br>
* it only marginally reduces the power when the endpoint and new
predictor are not associated, * it strongly increases the power when the
endpoint and new predictor are associated, whilst maintaining very
reasonable FWER control.</p>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Cellamare2017" class="csl-entry">
Cellamare, Matteo, Steffen Ventz, Elisabeth Baudin, Carole D. Mitnick,
and Lorenzo Trippa. 2017. <span>“A Bayesian Response-Adaptive Trial in
Tuberculosis: The endTB Trial.”</span> <em>Clinical Trials</em> 14 (1):
17–28. <a href="https://doi.org/10.1177/1740774516665090" class="external-link">https://doi.org/10.1177/1740774516665090</a>.
</div>
<div id="ref-Gotmaker" class="csl-entry">
Gotmaker, Robert, Michael J Barrington, John Reynolds, Lorenzo Trippa,
and Stephane Heritier. 2019. <span>“Bayesian Adaptive Design: The Future
for Regional Anesthesia Trials?”</span> <em>Regional Anesthesia &amp;
Pain Medicine</em> 44 (6): 617–22. <a href="https://doi.org/10.1136/rapm-2018-100248" class="external-link">https://doi.org/10.1136/rapm-2018-100248</a>.
</div>
<div id="ref-Shiyuan2014" class="csl-entry">
Shiyuan Zhang, Manyat Nantha-Aree, James Paul, and Lehana Thabane. 2014.
<span>“Empirical Comparison of Four Baseline Covariate Adjustment
Methods in Analysis of Continuous Outcomes in Randomized Controlled
Trials.”</span> <em>Clin Epidemiol.</em> 6: 227–35. <a href="https://doi.org/10.1177/0193841X0102500101" class="external-link">https://doi.org/10.1177/0193841X0102500101</a>.
</div>
<div id="ref-trippa2012" class="csl-entry">
Trippa, Lorenzo, Eudocia Q. Lee, Patrick Y. Wen, Tracy T. Batchelor,
Timothy Cloughesy, Giovanni Parmigiani, and Brian M. Alexander. 2012.
<span>“Bayesian Adaptive Randomized Trial Design for Patients with
Recurrent Glioblastoma.”</span> <em>Journal of Clinical Oncology</em> 30
(26): 3258–63. <a href="https://doi.org/10.1200/JCO.2011.39.8420" class="external-link">https://doi.org/10.1200/JCO.2011.39.8420</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dominique-Laurent Couturier, Liz Ryan, Rainer Puhr, Thomas Jaki, Stephane Heritier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
